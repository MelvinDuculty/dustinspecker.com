<!DOCTYPE html>
  <html lang="en" ng-app="dustinSpecker">
  <head>
    <meta charset="utf-8">
    <title>Dustin Specker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Bootstrap-->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" media="screen">

    <!--jQuery-->
    <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!--Bootstrap javascript-->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!--Angular-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.11/angular.min.js"></script>
    <script src="//unpkg.com/@uirouter/angularjs@1.0.12/release/angular-ui-router.min.js"></script>
    <script src="angular/angular-local-storage.js"></script>

    <style>
      form button {
        width: 45%;
      }
    </style>
  </head>

  <body>

    <!--top navigation-->
    <nav class="navbar navbar-default" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" ui-sref="home">Dustin Specker</a>
      </div>

      <div class="collapse navbar-collapse navbar-main-collapse">
        <ul class="nav navbar-nav">
          <li ui-sref-active="{active: 'home'}"><a ui-sref="home">Home</a></li>
          <li ui-sref-active="{active: 'lifts'}"><a ui-sref="lifts">Lifts</a></li>
        </ul>
      </div>
    </nav>

    <!--main content-->
    <ui-view></ui-view>

    <!--footer-->
    <footer class="well well-sm text-center"><a href="#/changelog">Change Log</a></footer>

    <script>
      var app = angular.module('dustinSpecker', ['LocalStorageModule', 'ui.router']);
      app.controller('warmupCtrl', function($location, $stateParams, localStorageService) {
        // lift name
        this.lift = $stateParams.lift;

        // gets current lift work weight
        if(localStorageService.get(this.lift) == null) {
          localStorageService.add(this.lift, 50);
        }
        this.workset = parseInt(localStorageService.get(this.lift));

        // gets current lift comment
        this.comment = localStorageService.get(this.lift + 'Comment');

        // total weight
        this.warmup1 = 45;
        this.warmup2 = 45;
        this.warmup3 = 45;
        this.warmup4 = 45;

        // plates
        this.plate1 = "";
        this.plate2 = "";
        this.plate3 = "";
        this.plate4 = "";
        this.plate5 = "";


        this.update = function() {
          localStorageService.add(this.lift, this.workset);
          var increment = (this.workset - 45) / 4;
          this.warmup1 = 45;
          this.warmup2 = round5(this.warmup1 + increment);
          this.warmup3 = round5(this.warmup2 + increment);
          this.warmup4 = round5(this.warmup3 + increment);

          this.plate1 = "bar";
          this.plate2 = this.warmup2 == 45 ? "bar" : plates(this.warmup2, "");
          this.plate3 = this.warmup3 == 45 ? "bar" : plates(this.warmup3, "");
          this.plate4 = this.warmup4 == 45 ? "bar" : plates(this.warmup4, "");
          this.plate5 = this.workset == 45 ? "bar" : plates(this.workset, "");
        };

        this.update(); // update to get initial display values

        this.updateComment = function() {
          localStorageService.add(this.lift + 'Comment', this.comment);
        };

        function round5(x) {
          return (x%5 > 2.5) ? parseInt(x/5)*5+5 : parseInt(x/5)*5;
        }

        function plates(x, plateString) {
          if(x >= 135) { // 45lb
            x -= 90;
            plateString += "45 ";
          } else if(x >= 115) { // 35lb
            x -= 70;
            plateString += "35 ";
          } else if(x >= 95) { // 25lb
            x -= 50;
            plateString += "25 ";
          } else if(x >= 65) { // 10lb
            x -= 20;
            plateString += "10 ";
          } else if(x >= 55) { // 5lb
            x -= 10;
            plateString += "5 ";
          } else if(x >= 50) { // 2.5lb
            x -= 5;
            plateString += "2.5 ";
          }

          if(x > 45) {
            return plates(x, plateString);
          } else {
            return plateString;
          }
        }
      });

      // load page content based on URL change
      app.config(function ($stateProvider) {
        $stateProvider
          .state({
            name: 'home',
            url: '/',
            templateUrl: 'pages/home.html'
          })
          .state({
            name: 'changelog',
            url: '/changelog',
            templateUrl: 'pages/changelog.html'
          })
          .state({
            name: 'lifts',
            url: '/lifts',
            templateUrl: 'pages/lifts.html'
          })
          .state({
            name: 'lifts.warmup',
            url: '/:lift',
            views: {
              '@': {
                templateUrl: 'pages/warmup.html',
                controller: 'warmupCtrl',
                controllerAs: 'warmup'
              }
            }
          });
      });
    </script>

  </body>
  </html>

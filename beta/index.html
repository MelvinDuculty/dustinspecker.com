<!DOCTYPE html>
  <html lang="en" ng-app="dustinSpecker">
  <head>
    <meta charset="utf-8">
    <title>Dustin Specker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Bootstrap-->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" media="screen">

    <!--jQuery-->
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <!--Bootstrap javascript-->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!--Angular-->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
    <script src="angular/angular-local-storage.js"></script>

    <style>
      form button {
        width: 45%;
      }
    </style>
  </head>

  <body ng-controller="bodyCtrl">

    <!--top navigation-->
    <nav class="navbar navbar-default" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#/">Dustin Specker</a>
      </div>

      <div class="collapse navbar-collapse navbar-main-collapse">
        <ul class="nav navbar-nav">
          <li ng-class="getActiveLink('/')"><a href="#/">Home</a></li>
          <li ng-class="getActiveLink('/lifts')"><a href="#/lifts">Lifts</a></li>
        </ul>
      </div>
    </nav>

    <!--main content-->
    <ng-view></ng-view>

    <!--footer-->
    <footer class="well well-sm text-center"><a href="#/changelog">Change Log</a></footer>

    <script>
      var app = angular.module('dustinSpecker', ['LocalStorageModule']);
      app.controller('bodyCtrl', function($scope, $location) {

        // active tab class
        $scope.activetab = ($location.path().indexOf('/lifts') !== -1) ? '/lifts' : '/';
        $scope.setTab = function(tab) {
          $scope.activetab = tab;
        }
        $scope.getActiveLink = function(path) {
          return (path == $scope.activetab) ? 'active' : '';
        }
      });
      app.controller('changeLogCtrl', function($scope) {
        $scope.setTab('/changelog');
      })
      app.controller('homeCtrl', function($scope) {
        $scope.setTab('/');
      });
      app.controller('liftsCtrl', function($scope) {
        $scope.setTab('/lifts');
      });
      app.controller('warmupCtrl', function($scope, $location, $routeParams, localStorageService) {
        // lift name
        $scope.lift = $routeParams.lift;

        // gets current lift work weight
        if(localStorageService.get($scope.lift) == null) {
          localStorageService.add($scope.lift, 50);
        }
        $scope.workset = parseInt(localStorageService.get($scope.lift));

        // gets current lift comment
        $scope.comment = localStorageService.get($scope.lift + 'Comment');

        // total weight
        $scope.warmup1 = 45;
        $scope.warmup2 = 45;
        $scope.warmup3 = 45;
        $scope.warmup4 = 45;

        // plates
        $scope.plate1 = "";
        $scope.plate2 = "";
        $scope.plate3 = "";
        $scope.plate4 = "";
        $scope.plate5 = "";


        $scope.update = function() {
          localStorageService.add($scope.lift, $scope.workset);
          var increment = ($scope.workset - 45) / 4;
          $scope.warmup1 = 45;
          $scope.warmup2 = round5($scope.warmup1 + increment);
          $scope.warmup3 = round5($scope.warmup2 + increment);
          $scope.warmup4 = round5($scope.warmup3 + increment);

          $scope.plate1 = "bar";
          $scope.plate2 = $scope.warmup2 == 45 ? "bar" : plates($scope.warmup2, "");
          $scope.plate3 = $scope.warmup3 == 45 ? "bar" : plates($scope.warmup3, "");
          $scope.plate4 = $scope.warmup4 == 45 ? "bar" : plates($scope.warmup4, "");
          $scope.plate5 = $scope.workset == 45 ? "bar" : plates($scope.workset, "");
        };

        $scope.update(); // update to get initial display values

        $scope.updateComment = function() {
          localStorageService.add($scope.lift + 'Comment', $scope.comment);
        };

        function round5(x) {
          return (x%5 > 2.5) ? parseInt(x/5)*5+5 : parseInt(x/5)*5;
        }

        function plates(x, plateString) {
          if(x >= 135) { // 45lb
            x -= 90;
            plateString += "45 ";
          } else if(x >= 115) { // 35lb
            x -= 70;
            plateString += "35 ";
          } else if(x >= 95) { // 25lb
            x -= 50;
            plateString += "25 ";
          } else if(x >= 65) { // 10lb
            x -= 20;
            plateString += "10 ";
          } else if(x >= 55) { // 5lb
            x -= 10;
            plateString += "5 ";
          } else if(x >= 50) { // 2.5lb
            x -= 5;
            plateString += "2.5 ";
          }

          if(x > 45) {
            return plates(x, plateString);
          } else {
            return plateString;
          }
        }
      });

      // load page content based on URL change
      app.config(['$routeProvider', function($routeProvider, $locationProvider) {
        $routeProvider
          .when('/', {
            templateUrl: 'pages/home.html',
            controller: 'homeCtrl'
          })
          .when('/changelog', {
            templateUrl: 'pages/changelog.html',
            controller: 'changeLogCtrl'
          })
          .when('/lifts', {
            templateUrl: 'pages/lifts.html',
            controller: 'liftsCtrl'
          })
          .when('/lifts/:lift', {
            templateUrl: 'pages/warmup.html',
            controller: 'warmupCtrl'
          })
          .otherwise({
            redirectTo: '/'
          });
      }]);
    </script>

  </body>
  </html>
